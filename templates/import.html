{% extends "base.html" %}
{% block content %}

<section class="card" style="max-width:880px;margin:0 auto;">
  <div class="card__hd">
    <div class="card__title">导入 Excel 数据</div>
    <div class="card__sub">支持 .xlsx；表头可用中文或字段名</div>
  </div>
  <div class="card__bd">

    {% if ok is not none %}
      <div style="background:#ecfdf5;border:1px solid #bbf7d0;color:#065f46;padding:8px 10px;border-radius:10px;margin-bottom:12px;">
        ✅ 导入成功 {{ ok }} 条 {% if filename %}（文件：{{ filename }}）{% endif %}
      </div>
    {% endif %}

    {% if errors %}
      <div style="background:#fef2f2;border:1px solid #fecaca;color:#991b1b;padding:8px 10px;border-radius:10px;margin-bottom:12px;">
        ❌ 部分行导入失败：
        <ul style="margin:6px 0 0 18px;">
          {% for e in errors %}
            <li>{{ e }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    <form method="post" action="/import" enctype="multipart/form-data" class="stack">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div>
          <label class="label">目标库</label>
          <select class="input" name="table" required>
            <option value="reserve">储备库（reserve）</option>
            <option value="offering">出让库（offering）</option>
            <option value="deal">成交库（deal）</option>
          </select>
        </div>
        <div>
          <label class="label">表头类型</label>
          <select class="input" name="header_type" required>
            <option value="cn">中文表头（如：ID、名称、矿种、地州、发布出让公告时间…）</option>
            <option value="en">英文字段名（如：id、name、mineral_type、region、announcement_date…）</option>
          </select>
        </div>
      </div>

      <div>
        <label class="label">Excel 文件（.xlsx）</label>
        <input class="input" type="file" name="file" accept=".xlsx" required />
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <button class="btn" type="submit">开始导入</button>
        <a class="btn btn--ghost" href="/">返回首页</a>
      </div>
    </form>

    <hr style="border:none;border-top:1px solid var(--border);margin:16px 0;" />

    <div class="stack">
      <div class="label" style="font-weight:700;">模板说明</div>
      <div class="badge">必填：ID、名称</div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>中文表头</th>
              <th>对应字段名</th>
            </tr>
          </thead>
          <tbody>
            {% for k,v in TABLE_LABELS.items() %}{% endfor %}
            {% set FL = FIELD_LABELS %}
            {% for en,col_cn in FL.items() %}
              <tr>
                <td>{{ col_cn }}</td>
                <td>{{ en }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>
</section>

{% endblock %}
